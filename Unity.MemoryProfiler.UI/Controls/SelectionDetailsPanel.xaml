<UserControl x:Class="Unity.MemoryProfiler.UI.Controls.SelectionDetailsPanel"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:Unity.MemoryProfiler.UI.Controls"
             xmlns:vm="clr-namespace:Unity.MemoryProfiler.UI.ViewModels.SelectionDetails"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="350"
             d:DataContext="{d:DesignInstance Type=vm:SelectionDetailsViewModel}"
             Background="White">
    <UserControl.Resources>
        <Style x:Key="SectionHeaderStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,10,0,5"/>
            <Setter Property="Foreground" Value="#333333"/>
        </Style>
        <Style x:Key="PropertyLabelStyle" TargetType="TextBlock">
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="#666666"/>
            <Setter Property="Margin" Value="0,3,10,3"/>
            <Setter Property="VerticalAlignment" Value="Top"/>
        </Style>
        <Style x:Key="PropertyValueStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#333333"/>
            <Setter Property="Margin" Value="0,3,0,3"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
            <Setter Property="VerticalAlignment" Value="Top"/>
        </Style>
        
        <!-- PropertyItem DataTemplate -->
        <DataTemplate x:Key="PropertyItemTemplate">
            <Grid Margin="0,3">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="120"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="{Binding Label}" 
                           Style="{StaticResource PropertyLabelStyle}"
                           ToolTip="{Binding Tooltip}"/>
                <TextBlock Grid.Column="1" 
                           Text="{Binding Value}"
                           Style="{StaticResource PropertyValueStyle}"
                           ToolTip="{Binding Tooltip}"/>
            </Grid>
        </DataTemplate>
    </UserControl.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
        <StackPanel Margin="15">
            <!-- 标题区域 -->
            <TextBlock Text="{Binding Title}" 
                       FontSize="16" 
                       FontWeight="Bold" 
                       TextWrapping="Wrap"
                       Foreground="#333333"
                       Margin="0,0,0,15"/>

            <!-- 无选择时的提示 -->
            <TextBlock Text="Select an item in the table to view its details here."
                       Foreground="Gray"
                       FontStyle="Italic"
                       TextWrapping="Wrap"
                       Visibility="{Binding NoSelectionMessageVisibility}"/>

            <!-- 详情内容容器 -->
            <StackPanel Visibility="{Binding DetailsContentVisibility}">
                
                <!-- 基本信息组 -->
                <Expander IsExpanded="True" 
                          Margin="0,5,0,10"
                          Visibility="{Binding BasicInfo.Visibility}">
                    <Expander.HeaderTemplate>
                        <DataTemplate>
                            <TextBlock Text="Basic Information" Style="{StaticResource SectionHeaderStyle}"/>
                        </DataTemplate>
                    </Expander.HeaderTemplate>
                    <ItemsControl ItemsSource="{Binding BasicInfo.Properties}"
                                  ItemTemplate="{StaticResource PropertyItemTemplate}"
                                  Margin="10,5,0,5"/>
                </Expander>

                <!-- 内存信息组 -->
                <Expander IsExpanded="True" 
                          Margin="0,5,0,10"
                          Visibility="{Binding MemoryInfo.Visibility}">
                    <Expander.HeaderTemplate>
                        <DataTemplate>
                            <TextBlock Text="Memory Information" Style="{StaticResource SectionHeaderStyle}"/>
                        </DataTemplate>
                    </Expander.HeaderTemplate>
                    <ItemsControl ItemsSource="{Binding MemoryInfo.Properties}"
                                  ItemTemplate="{StaticResource PropertyItemTemplate}"
                                  Margin="10,5,0,5"/>
                </Expander>

                <!-- 描述信息组 -->
                <Expander IsExpanded="False" 
                          Margin="0,5,0,10"
                          Visibility="{Binding Description.Visibility}">
                    <Expander.HeaderTemplate>
                        <DataTemplate>
                            <TextBlock Text="Description" Style="{StaticResource SectionHeaderStyle}"/>
                        </DataTemplate>
                    </Expander.HeaderTemplate>
                    <TextBlock Text="{Binding Description.Text}" 
                               Style="{StaticResource PropertyValueStyle}"
                               Margin="10,5,0,5"/>
                </Expander>

                <!-- 元数据组 -->
                <Expander IsExpanded="False" 
                          Margin="0,5,0,10"
                          Visibility="{Binding MetaData.Visibility}">
                    <Expander.HeaderTemplate>
                        <DataTemplate>
                            <TextBlock Text="MetaData" Style="{StaticResource SectionHeaderStyle}"/>
                        </DataTemplate>
                    </Expander.HeaderTemplate>
                    <ItemsControl ItemsSource="{Binding MetaData.Properties}"
                                  ItemTemplate="{StaticResource PropertyItemTemplate}"
                                  Margin="10,5,0,5"/>
                </Expander>

                <!-- 帮助组 -->
                <Expander IsExpanded="True" 
                          Margin="0,5,0,10"
                          Visibility="{Binding Help.Visibility}">
                    <Expander.HeaderTemplate>
                        <DataTemplate>
                            <TextBlock Text="Help" Style="{StaticResource SectionHeaderStyle}"/>
                        </DataTemplate>
                    </Expander.HeaderTemplate>
                    <ItemsControl ItemsSource="{Binding Help.Properties}"
                                  ItemTemplate="{StaticResource PropertyItemTemplate}"
                                  Margin="10,5,0,5"/>
                </Expander>

                <!-- 高级信息组 -->
                <Expander IsExpanded="False" 
                          Margin="0,5,0,10"
                          Visibility="{Binding AdvancedInfo.Visibility}">
                    <Expander.HeaderTemplate>
                        <DataTemplate>
                            <TextBlock Text="Advanced" Style="{StaticResource SectionHeaderStyle}"/>
                        </DataTemplate>
                    </Expander.HeaderTemplate>
                    <ItemsControl ItemsSource="{Binding AdvancedInfo.Properties}"
                                  ItemTemplate="{StaticResource PropertyItemTemplate}"
                                  Margin="10,5,0,5"/>
                </Expander>

                <!-- 调用堆栈组 -->
                <Expander IsExpanded="True" 
                          Margin="0,5,0,10"
                          Visibility="{Binding CallStacks.Visibility}">
                    <Expander.HeaderTemplate>
                        <DataTemplate>
                            <TextBlock Text="Call Stack Info" Style="{StaticResource SectionHeaderStyle}"/>
                        </DataTemplate>
                    </Expander.HeaderTemplate>
                    <StackPanel Margin="10,5,0,5">
                        <!-- Copy 按钮 -->
                        <Button Content="Copy Call Stack"
                                Command="{Binding CallStacks.CopyCommand}"
                                Padding="10,5"
                                Margin="0,5"/>
                        
                        <!-- 计数 -->
                        <Grid Margin="0,3">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Call Stacks:" Style="{StaticResource PropertyLabelStyle}"/>
                            <TextBlock Grid.Column="1" 
                                       Text="{Binding CallStacks.CallStackCount}"
                                       Style="{StaticResource PropertyValueStyle}"/>
                        </Grid>
                        
                        <!-- Toggle 开关 -->
                        <CheckBox Content="Clickable Call Stacks"
                                  IsChecked="{Binding CallStacks.ClickableCallStacks}"
                                  Margin="0,5"
                                  ToolTip="Call Stacks can either be clickable (leading to the source file) or selectable. Toggle this off if you want them to be selectable.&#x0a;Note: File jumping is not available in WPF version."/>
                        
                        <CheckBox Content="Show Address in Call Stacks"
                                  IsChecked="{Binding CallStacks.ShowAddress}"
                                  Margin="0,5"
                                  ToolTip="Show or hide Address in Call Stacks."/>
                        
                        <!-- 堆栈内容 -->
                        <Expander Header="Allocation Call Stack" 
                                  IsExpanded="False"
                                  Margin="0,5">
                            <TextBlock Text="{Binding CallStacks.CallStackText}"
                                       TextWrapping="Wrap"
                                       FontFamily="Consolas"
                                       Margin="10,5"/>
                        </Expander>
                    </StackPanel>
                </Expander>

                <!-- Managed对象检查器组 -->
                <Expander x:Name="ManagedFieldsExpander" 
                          IsExpanded="True" 
                          Margin="0,5,0,10"
                          Visibility="Collapsed">
                    <Expander.HeaderTemplate>
                        <DataTemplate>
                            <TextBlock Text="Managed Fields" Style="{StaticResource SectionHeaderStyle}"/>
                        </DataTemplate>
                    </Expander.HeaderTemplate>
                    <local:ManagedObjectInspector x:Name="ManagedObjectInspectorControl" 
                                                  Height="300"
                                                  Margin="10,5,0,5"/>
                </Expander>

                <!-- 引用浏览器组 (References / Paths To Root) -->
                <Expander x:Name="ReferencesExpander" 
                          IsExpanded="True" 
                          Margin="0,5,0,10"
                          Visibility="Collapsed">
                    <Expander.HeaderTemplate>
                        <DataTemplate>
                            <TextBlock Text="References" Style="{StaticResource SectionHeaderStyle}"/>
                        </DataTemplate>
                    </Expander.HeaderTemplate>
                    <local:PathsToRootView x:Name="PathsToRootViewControl" 
                                           Height="400"
                                           Margin="10,5,0,5"/>
                </Expander>

            </StackPanel>
        </StackPanel>
    </ScrollViewer>
</UserControl>
