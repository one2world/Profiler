<UserControl x:Class="Unity.MemoryProfiler.UI.Views.ManagedObjectsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:Unity.MemoryProfiler.UI.Views"
             xmlns:controls="clr-namespace:Unity.MemoryProfiler.UI.Controls"
             xmlns:converters="clr-namespace:Unity.MemoryProfiler.UI.Converters"
             xmlns:models="clr-namespace:Unity.MemoryProfiler.UI.Models"
             xmlns:viewModels="clr-namespace:Unity.MemoryProfiler.UI.ViewModels"
             xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid"
             mc:Ignorable="d" 
             d:DesignHeight="800" d:DesignWidth="1400"
             d:DataContext="{d:DesignInstance Type=viewModels:ManagedObjectsViewModel}"
             Background="White">
    <UserControl.Resources>
        <ResourceDictionary>
            <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>
            <converters:NotNullToVisibilityConverter x:Key="NotNullToVisibilityConverter"/>
            <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
            <converters:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter"/>
            <converters:BoolToStringConverter x:Key="BoolToStringConverter"/>
            <converters:DeltaToColorConverter x:Key="DeltaToColorConverter"/>
        </ResourceDictionary>
    </UserControl.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- 标题和总计 -->
        <Border Grid.Row="0" Background="#F5F5F5" Padding="15,10">
            <StackPanel>
                <TextBlock Text="Managed Objects" FontSize="20" FontWeight="SemiBold"/>
                
                <!-- 单快照模式：显示描述 -->
                <TextBlock Text="Memory allocations grouped by call stack from GC.Alloc hooking." 
                           Foreground="Gray" Margin="0,5,0,0"
                           Visibility="{Binding IsComparisonMode, Converter={StaticResource InverseBoolToVisibilityConverter}}"/>
                
                <!-- 对比模式：显示描述 -->
                <TextBlock Text="A comparison of managed memory allocations in each capture." 
                           Foreground="Gray" Margin="0,5,0,0"
                           Visibility="{Binding IsComparisonMode, Converter={StaticResource BoolToVisibilityConverter}}"/>
                
                <!-- 单快照模式：统计信息 -->
                <StackPanel Orientation="Horizontal" Margin="0,10,0,0"
                            Visibility="{Binding IsComparisonMode, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                    <TextBlock Margin="0,0,20,0">
                        <Run Text="Total Size: " FontWeight="SemiBold"/>
                        <Run Text="{Binding ManagedObjectsData.FormattedTotalSize, Mode=OneWay}" Foreground="#2196F3"/>
                    </TextBlock>
                    <TextBlock>
                        <Run Text="Total Objects: " FontWeight="SemiBold"/>
                        <Run Text="{Binding ManagedObjectsData.TotalCount, Mode=OneWay}" Foreground="#2196F3"/>
                    </TextBlock>
                </StackPanel>
                
                <!-- 对比模式：统计信息（A、B、Diff） -->
                <Grid Margin="0,10,0,0" Visibility="{Binding IsComparisonMode, Converter={StaticResource BoolToVisibilityConverter}}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- 第一行：Total Memory In Snapshot -->
                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Total Memory In Snapshot: " FontWeight="SemiBold" VerticalAlignment="Center"/>
                    <StackPanel Grid.Row="0" Grid.Column="1" Orientation="Horizontal" Margin="5,0,20,0">
                        <TextBlock Text="A: " FontWeight="SemiBold" Foreground="#666"/>
                        <TextBlock Text="{Binding FormattedTotalSnapshotSizeA, Mode=OneWay}"/>
                    </StackPanel>
                    <StackPanel Grid.Row="0" Grid.Column="2" Orientation="Horizontal" Margin="0,0,20,0">
                        <TextBlock Text="B: " FontWeight="SemiBold" Foreground="#666"/>
                        <TextBlock Text="{Binding FormattedTotalSnapshotSizeB, Mode=OneWay}"/>
                    </StackPanel>
                    <StackPanel Grid.Row="0" Grid.Column="3" Orientation="Horizontal">
                        <TextBlock Text="Diff: " FontWeight="SemiBold" Foreground="#666"/>
                        <TextBlock Text="{Binding FormattedTotalSnapshotSizeDiff, Mode=OneWay}" FontWeight="Bold"/>
                    </StackPanel>
                    
                    <!-- 第二行：Allocated Memory In Table -->
                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Allocated Memory In Table: " FontWeight="SemiBold" VerticalAlignment="Center" Margin="0,5,0,0"/>
                    <StackPanel Grid.Row="1" Grid.Column="1" Orientation="Horizontal" Margin="5,5,20,0">
                        <TextBlock Text="A: " FontWeight="SemiBold" Foreground="#666"/>
                        <TextBlock Text="{Binding FormattedTotalSizeInTableA, Mode=OneWay}" Foreground="#2196F3"/>
                    </StackPanel>
                    <StackPanel Grid.Row="1" Grid.Column="2" Orientation="Horizontal" Margin="0,5,20,0">
                        <TextBlock Text="B: " FontWeight="SemiBold" Foreground="#666"/>
                        <TextBlock Text="{Binding FormattedTotalSizeInTableB, Mode=OneWay}" Foreground="#2196F3"/>
                    </StackPanel>
                    <StackPanel Grid.Row="1" Grid.Column="3" Orientation="Horizontal" Margin="0,5,0,0">
                        <TextBlock Text="Diff: " FontWeight="SemiBold" Foreground="#666"/>
                        <TextBlock Text="{Binding FormattedTotalSizeInTableDiff, Mode=OneWay}" FontWeight="Bold" Foreground="#2196F3"/>
                    </StackPanel>
                </Grid>
            </StackPanel>
        </Border>

        <!-- 工具栏 -->
        <Border Grid.Row="1" BorderBrush="#E0E0E0" BorderThickness="0,1" Padding="15,10" Background="White">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Text="{Binding StatusMessage}" VerticalAlignment="Center" Foreground="Gray"/>
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <!-- 对比模式：Include Unchanged 选项 -->
                    <CheckBox Content="Include Unchanged" IsChecked="{Binding IncludeUnchanged}" VerticalAlignment="Center" Margin="0,0,10,0"
                              Visibility="{Binding IsComparisonMode, Converter={StaticResource BoolToVisibilityConverter}}"/>
                    <Button Content="{Binding IsReversedMode, Converter={StaticResource BoolToStringConverter}, ConverterParameter='Normal|Reversed'}" Command="{Binding ToggleReversedModeCommand}" Padding="10,5" Margin="0,0,5,0"/>
                    <Button Content="Refresh" Command="{Binding RefreshCommand}" Padding="10,5"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- 主内容区域 -->
        <!-- 单快照模式 -->
        <Grid Grid.Row="2" Visibility="{Binding IsComparisonMode, Converter={StaticResource InverseBoolToVisibilityConverter}}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*" MinWidth="400"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="*" MinWidth="300"/>
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0" BorderBrush="#E0E0E0" BorderThickness="0,0,1,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <Border Grid.Row="0" Background="#F9F9F9" Padding="10,8" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1">
                        <TextBlock Text="Call Stacks" FontWeight="SemiBold" FontSize="14"/>
                    </Border>

                    <dxg:TreeListControl Grid.Row="1" x:Name="CallStackTreeList" ItemsSource="{Binding ManagedObjectsData.RootNodes}" ShowBorder="False" SelectionMode="Row">
                        <dxg:TreeListControl.View>
                            <dxg:TreeListView AutoWidth="False" NavigationStyle="Row" AllowEditing="False" ShowIndicator="False" TreeDerivationMode="ChildNodesSelector" ChildNodesPath="Children" ShowVerticalLines="False" ShowHorizontalLines="True" AllowPerPixelScrolling="True" AllowCascadeUpdate="True" AllowSorting="True" FocusedRowChanged="OnCallStackFocusedRowChanged" ShowAutoFilterRow="True" AllowColumnFiltering="True" ShowSearchPanelMode="Always" SearchPanelNullText="Search call stacks..." AllowScrollAnimation="True"/>
                        </dxg:TreeListControl.View>
                        <dxg:TreeListControl.Columns>
                            <dxg:TreeListColumn Header="Description (Function)" FieldName="Description" MinWidth="200" AllowSorting="True" FixedWidth="False"/>
                            <dxg:TreeListColumn Header="Size" FieldName="FormattedSize" Width="120" AllowSorting="True" FixedWidth="True"/>
                            <dxg:TreeListColumn Header="%" FieldName="FormattedPercentage" Width="80" AllowSorting="True" FixedWidth="True"/>
                            <dxg:TreeListColumn Header="Count" FieldName="Count" Width="100" AllowSorting="True" FixedWidth="True"/>
                            <dxg:TreeListColumn Header="Module" FieldName="Module" Width="250" AllowSorting="True" FixedWidth="True"/>
                        </dxg:TreeListControl.Columns>
                    </dxg:TreeListControl>
                </Grid>
            </Border>

            <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" Background="#E0E0E0"/>

            <Border Grid.Column="2">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="5"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <Border Grid.Row="0">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <Border Grid.Row="0" Background="#F9F9F9" Padding="10,8" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1">
                                <TextBlock Text="Objects (Grouped by Type)" FontWeight="SemiBold" FontSize="14"/>
                            </Border>

                            <dxg:TreeListControl Grid.Row="1" x:Name="DetailTreeList" ItemsSource="{Binding DetailNodes}" ShowBorder="False" SelectionMode="Row" Visibility="{Binding DetailNodes, Converter={StaticResource NotNullToVisibilityConverter}}">
                                <dxg:TreeListControl.View>
                                    <dxg:TreeListView AutoWidth="True" NavigationStyle="Row" AllowEditing="False" ShowIndicator="False" TreeDerivationMode="ChildNodesSelector" ChildNodesPath="Children" ShowVerticalLines="False" ShowHorizontalLines="True" AllowPerPixelScrolling="True" AllowSorting="True" FocusedRowChanged="OnDetailFocusedRowChanged"/>
                                </dxg:TreeListControl.View>
                                <dxg:TreeListControl.Columns>
                                    <dxg:TreeListColumn Header="Name/Address" FieldName="Name" Width="200"/>
                                    <dxg:TreeListColumn Header="Size" FieldName="FormattedSize" Width="100"/>
                                    <dxg:TreeListColumn Header="Count" FieldName="Count" Width="70"/>
                                </dxg:TreeListControl.Columns>
                            </dxg:TreeListControl>

                            <Border Grid.Row="1" Visibility="{Binding DetailNodes, Converter={StaticResource NullToVisibilityConverter}}">
                                <TextBlock Text="Select a call stack to view objects" Foreground="#999999" FontStyle="Italic" HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="14"/>
                            </Border>
                        </Grid>
                    </Border>

                    <GridSplitter Grid.Row="1" Height="5" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Background="#E0E0E0"/>

                    <Border Grid.Row="2">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <Border Grid.Row="0" Background="#F9F9F9" Padding="10,8" BorderBrush="#E0E0E0" BorderThickness="0,1,0,1">
                                <TextBlock Text="Allocation Sites (File:Line)" FontWeight="SemiBold" FontSize="14"/>
                            </Border>

                            <dxg:GridControl Grid.Row="1" x:Name="AllocationSitesGrid" ItemsSource="{Binding AllocationSites}" ShowBorder="False" SelectionMode="Row" Visibility="{Binding AllocationSites, Converter={StaticResource NotNullToVisibilityConverter}}">
                                <dxg:GridControl.View>
                                    <dxg:TableView AutoWidth="True" NavigationStyle="Row" AllowEditing="False" ShowIndicator="False" ShowVerticalLines="False" ShowHorizontalLines="True" AllowPerPixelScrolling="True" AllowSorting="True" RowDoubleClick="OnAllocationSiteDoubleClick"/>
                                </dxg:GridControl.View>
                                <dxg:GridControl.Columns>
                                    <dxg:GridColumn Header="Description" FieldName="Description" Width="150"/>
                                    <dxg:GridColumn Header="Size" FieldName="FormattedSize" Width="80"/>
                                    <dxg:GridColumn Header="File:Line" FieldName="FileLocation" Width="300"/>
                                </dxg:GridControl.Columns>
                            </dxg:GridControl>

                            <Border Grid.Row="1" Visibility="{Binding AllocationSites, Converter={StaticResource NullToVisibilityConverter}}">
                                <TextBlock Text="Select a call stack to view allocation sites" Foreground="#999999" FontStyle="Italic" HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="14"/>
                            </Border>
                        </Grid>
                    </Border>
                </Grid>
            </Border>
        </Grid>

        <!-- 对比模式 -->
        <Grid Grid.Row="2" Visibility="{Binding IsComparisonMode, Converter={StaticResource BoolToVisibilityConverter}}">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="5"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- 对比主表 -->
            <Border Grid.Row="0" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <Border Grid.Row="0" Background="#F9F9F9" Padding="10,8" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1">
                        <TextBlock Text="Comparison (Call Stacks)" FontWeight="SemiBold" FontSize="14"/>
                    </Border>

                    <dxg:TreeListControl Grid.Row="1" x:Name="ComparisonTreeList" ItemsSource="{Binding ComparisonModel.RootNodes}" ShowBorder="False" SelectionMode="Row">
                        <dxg:TreeListControl.View>
                            <dxg:TreeListView AutoWidth="False" NavigationStyle="Row" AllowEditing="False" ShowIndicator="False" TreeDerivationMode="ChildNodesSelector" ChildNodesPath="Children" ShowVerticalLines="False" ShowHorizontalLines="True" AllowPerPixelScrolling="True" AllowSorting="True" FocusedRowChanged="OnComparisonFocusedRowChanged"/>
                        </dxg:TreeListControl.View>
                        <dxg:TreeListControl.Columns>
                            <dxg:TreeListColumn Header="Description" FieldName="Name" MinWidth="200"/>
                            <dxg:TreeListColumn Header="Size Delta" FieldName="SizeDeltaFormatted" Width="120">
                                <dxg:TreeListColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding RowData.Row.SizeDeltaFormatted}" Foreground="{Binding RowData.Row.SizeDelta, Converter={StaticResource DeltaToColorConverter}}" FontWeight="Bold"/>
                                    </DataTemplate>
                                </dxg:TreeListColumn.CellTemplate>
                            </dxg:TreeListColumn>
                            <dxg:TreeListColumn Header="Size (A)" FieldName="TotalSizeInAFormatted" Width="120"/>
                            <dxg:TreeListColumn Header="Size (B)" FieldName="TotalSizeInBFormatted" Width="120"/>
                            <dxg:TreeListColumn Header="Count Delta" FieldName="CountDelta" Width="100">
                                <dxg:TreeListColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding RowData.Row.CountDelta, StringFormat='{}{0:+#;-#;0}'}" Foreground="{Binding RowData.Row.CountDelta, Converter={StaticResource DeltaToColorConverter}}" FontWeight="Bold"/>
                                    </DataTemplate>
                                </dxg:TreeListColumn.CellTemplate>
                            </dxg:TreeListColumn>
                            <dxg:TreeListColumn Header="Count (A)" FieldName="CountInA" Width="100"/>
                            <dxg:TreeListColumn Header="Count (B)" FieldName="CountInB" Width="100"/>
                        </dxg:TreeListControl.Columns>
                    </dxg:TreeListControl>
                </Grid>
            </Border>

            <GridSplitter Grid.Row="1" Height="5" HorizontalAlignment="Stretch" Background="#E0E0E0"/>

            <!-- Base 和 Compared 子表 -->
            <Grid Grid.Row="2">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="5"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Base 子表 -->
                <Border Grid.Column="0" BorderBrush="#E0E0E0" BorderThickness="0,0,1,0">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="2*" MinWidth="200"/>
                            <ColumnDefinition Width="5"/>
                            <ColumnDefinition Width="*" MinWidth="150"/>
                        </Grid.ColumnDefinitions>

                        <!-- Base Objects -->
                        <Grid Grid.Column="0">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <Border Grid.Row="0" Background="#F9F9F9" Padding="10,8" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1">
                                <TextBlock Text="Base (A) - Objects" FontWeight="SemiBold" FontSize="14"/>
                            </Border>

                            <Border Grid.Row="1" Background="#FFF9E6" Padding="8,5" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1"
                                    Visibility="{Binding ShowBaseDescription, Converter={StaticResource BoolToVisibilityConverter}}">
                                <TextBlock Text="{Binding BaseDescription}" TextWrapping="Wrap" Foreground="#666"/>
                            </Border>

                            <dxg:TreeListControl Grid.Row="2" x:Name="BaseTreeList" ItemsSource="{Binding BaseFilteredNodes}" ShowBorder="False" SelectionMode="Row">
                                <dxg:TreeListControl.View>
                                    <dxg:TreeListView AutoWidth="False" NavigationStyle="Row" AllowEditing="False" ShowIndicator="False" TreeDerivationMode="ChildNodesSelector" ChildNodesPath="Children" ShowVerticalLines="False" ShowHorizontalLines="True" AllowPerPixelScrolling="True" AllowSorting="True" FocusedRowChanged="OnBaseFocusedRowChanged"/>
                                </dxg:TreeListControl.View>
                                <dxg:TreeListControl.Columns>
                                    <dxg:TreeListColumn Header="Name/Address" FieldName="Name" MinWidth="120"/>
                                    <dxg:TreeListColumn Header="Size" FieldName="FormattedSize" Width="80"/>
                                    <dxg:TreeListColumn Header="Count" FieldName="Count" Width="60"/>
                                </dxg:TreeListControl.Columns>
                            </dxg:TreeListControl>
                        </Grid>

                        <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" Background="#E0E0E0"/>

                        <!-- Base AllocationSites -->
                        <Grid Grid.Column="2">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <Border Grid.Row="0" Background="#F9F9F9" Padding="10,8" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1">
                                <TextBlock Text="Allocation Sites (A)" FontWeight="SemiBold" FontSize="14"/>
                            </Border>

                            <dxg:GridControl Grid.Row="1" x:Name="BaseAllocationSitesGrid" ItemsSource="{Binding BaseAllocationSites}" ShowBorder="False" SelectionMode="Row" Visibility="{Binding BaseAllocationSites, Converter={StaticResource NotNullToVisibilityConverter}}">
                                <dxg:GridControl.View>
                                    <dxg:TableView AutoWidth="True" NavigationStyle="Row" AllowEditing="False" ShowIndicator="False" ShowVerticalLines="False" ShowHorizontalLines="True" AllowPerPixelScrolling="True" AllowSorting="True" RowDoubleClick="OnBaseAllocationSiteDoubleClick"/>
                                </dxg:GridControl.View>
                                <dxg:GridControl.Columns>
                                    <dxg:GridColumn Header="Description" FieldName="Description" Width="100"/>
                                    <dxg:GridColumn Header="Size" FieldName="FormattedSize" Width="60"/>
                                    <dxg:GridColumn Header="File:Line" FieldName="FileLocation" Width="200"/>
                                </dxg:GridControl.Columns>
                            </dxg:GridControl>

                            <Border Grid.Row="1" Visibility="{Binding BaseAllocationSites, Converter={StaticResource NullToVisibilityConverter}}">
                                <TextBlock Text="No allocation sites" Foreground="#999999" FontStyle="Italic" HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="12"/>
                            </Border>
                        </Grid>
                    </Grid>
                </Border>

                <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" Background="#E0E0E0"/>

                <!-- Compared 子表 -->
                <Border Grid.Column="2">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="2*" MinWidth="200"/>
                            <ColumnDefinition Width="5"/>
                            <ColumnDefinition Width="*" MinWidth="150"/>
                        </Grid.ColumnDefinitions>

                        <!-- Compared Objects -->
                        <Grid Grid.Column="0">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <Border Grid.Row="0" Background="#F9F9F9" Padding="10,8" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1">
                                <TextBlock Text="Compared (B) - Objects" FontWeight="SemiBold" FontSize="14"/>
                            </Border>

                            <Border Grid.Row="1" Background="#E6F7FF" Padding="8,5" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1"
                                    Visibility="{Binding ShowComparedDescription, Converter={StaticResource BoolToVisibilityConverter}}">
                                <TextBlock Text="{Binding ComparedDescription}" TextWrapping="Wrap" Foreground="#666"/>
                            </Border>

                            <dxg:TreeListControl Grid.Row="2" x:Name="ComparedTreeList" ItemsSource="{Binding ComparedFilteredNodes}" ShowBorder="False" SelectionMode="Row">
                                <dxg:TreeListControl.View>
                                    <dxg:TreeListView AutoWidth="False" NavigationStyle="Row" AllowEditing="False" ShowIndicator="False" TreeDerivationMode="ChildNodesSelector" ChildNodesPath="Children" ShowVerticalLines="False" ShowHorizontalLines="True" AllowPerPixelScrolling="True" AllowSorting="True" FocusedRowChanged="OnComparedFocusedRowChanged"/>
                                </dxg:TreeListControl.View>
                                <dxg:TreeListControl.Columns>
                                    <dxg:TreeListColumn Header="Name/Address" FieldName="Name" MinWidth="120"/>
                                    <dxg:TreeListColumn Header="Size" FieldName="FormattedSize" Width="80"/>
                                    <dxg:TreeListColumn Header="Count" FieldName="Count" Width="60"/>
                                </dxg:TreeListControl.Columns>
                            </dxg:TreeListControl>
                        </Grid>

                        <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" Background="#E0E0E0"/>

                        <!-- Compared AllocationSites -->
                        <Grid Grid.Column="2">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <Border Grid.Row="0" Background="#F9F9F9" Padding="10,8" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1">
                                <TextBlock Text="Allocation Sites (B)" FontWeight="SemiBold" FontSize="14"/>
                            </Border>

                            <dxg:GridControl Grid.Row="1" x:Name="ComparedAllocationSitesGrid" ItemsSource="{Binding ComparedAllocationSites}" ShowBorder="False" SelectionMode="Row" Visibility="{Binding ComparedAllocationSites, Converter={StaticResource NotNullToVisibilityConverter}}">
                                <dxg:GridControl.View>
                                    <dxg:TableView AutoWidth="True" NavigationStyle="Row" AllowEditing="False" ShowIndicator="False" ShowVerticalLines="False" ShowHorizontalLines="True" AllowPerPixelScrolling="True" AllowSorting="True" RowDoubleClick="OnComparedAllocationSiteDoubleClick"/>
                                </dxg:GridControl.View>
                                <dxg:GridControl.Columns>
                                    <dxg:GridColumn Header="Description" FieldName="Description" Width="100"/>
                                    <dxg:GridColumn Header="Size" FieldName="FormattedSize" Width="60"/>
                                    <dxg:GridColumn Header="File:Line" FieldName="FileLocation" Width="200"/>
                                </dxg:GridControl.Columns>
                            </dxg:GridControl>

                            <Border Grid.Row="1" Visibility="{Binding ComparedAllocationSites, Converter={StaticResource NullToVisibilityConverter}}">
                                <TextBlock Text="No allocation sites" Foreground="#999999" FontStyle="Italic" HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="12"/>
                            </Border>
                        </Grid>
                    </Grid>
                </Border>
            </Grid>
        </Grid>
    </Grid>
</UserControl>
